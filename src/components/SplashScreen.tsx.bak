/**
 * Splash Screen Component - UIKit version
 * Renders INSIDE Canvas as 3D UI
 */

import { useEffect, useState } from 'react';
import { Capacitor } from '@capacitor/core';
import { SplashScreen as CapacitorSplashScreen } from '@capacitor/splash-screen';
import { Fullscreen, Container, Text, Image } from '@react-three/uikit';
import { log } from '../utils/Logger';

interface SplashScreenProps {
  onComplete: () => void;
  minDisplayTime?: number;
}

const SPLASH_VARIANTS = [
  'splash-8ee36901.png',
  'splash-cdbb752c.png', 
  'splash-57bc2748.png',
  'splash-0619b5cf.png',
  'splash-f7906440.png'
];

const SplashScreen: React.FC<SplashScreenProps> = ({ 
  onComplete, 
  minDisplayTime = 2000 
}) => {
  const [splashImage] = useState<string>(() => {
    const randomVariant = SPLASH_VARIANTS[Math.floor(Math.random() * SPLASH_VARIANTS.length)];
    return `/splash/${randomVariant}`;
  });

  useEffect(() => {
    const platform = Capacitor.getPlatform();

    // Handle native splash
    const initializeSplash = async () => {
      if (platform !== 'web') {
        try {
          log.debug('Native splash screen should be visible from launch');
        } catch (err) {
          log.warn('Native splash screen not available', err);
        }
      }
    };

    initializeSplash();

    // Minimum display time
    const minTimer = setTimeout(async () => {
      // Hide native splash
      if (platform !== 'web') {
        try {
          await CapacitorSplashScreen.hide();
          log.debug('Native splash screen hidden');
        } catch (err) {
          log.warn('Failed to hide native splash', err);
        }
      }

      // Delay before completing
      setTimeout(() => {
        onComplete();
      }, 300);
    }, minDisplayTime);

    return () => clearTimeout(minTimer);
  }, [onComplete, minDisplayTime]);

  // Native platforms use Capacitor splash
  if (Capacitor.getPlatform() !== 'web') {
    return null;
  }

  // Web: Show UIKit splash
  return (
    <Fullscreen 
      backgroundColor={0x1a202c}
      flexDirection="column"
      alignItems="center"
      justifyContent="center"
    >
      {/* Splash Image */}
      <Image 
        src={splashImage}
        width="100%"
        height="100%"
        objectFit="cover"
        opacity={0.9}
      />

      {/* Brand Overlay */}
      <Container
        positionType="absolute"
        flexDirection="column"
        alignItems="center"
        gap={32}
      >
        <Text 
          
          fontSize={64}
          fontWeight="bold"
          color={0xD69E2E}
        >
          Ebb & Bloom
        </Text>
        <Text
          fontFamily="inter"
          fontSize={20}
          fontWeight="light"
          color={0xA0AEC0}
        >
          Shape Worlds. Traits Echo. Legacy Endures.
        </Text>

        {/* Loading Indicator */}
        <Container flexDirection="row" alignItems="center" gap={12} marginTop={48}>
          <Container 
            width={48} 
            height={48} 
            borderRadius={24}
            borderWidth={4}
            borderColor={0xD69E2E}
          />
          <Text  fontSize={12} color={0xA0AEC0}>
            Initializing ecosystem...
          </Text>
        </Container>
      </Container>

      {/* Brand Color Accents */}
      <Container
        positionType="absolute"
        positionBottom={32}
        flexDirection="row"
        gap={16}
      >
        {[
          { color: 0x4A5568, label: 'Ebb' },
          { color: 0x38A169, label: 'Bloom' },
          { color: 0xD69E2E, label: 'Trait' },
          { color: 0xA0AEC0, label: 'Echo' }
        ].map((item, i) => (
          <Container key={i} flexDirection="column" alignItems="center" gap={8}>
            <Container width={12} height={12} borderRadius={6} backgroundColor={item.color} />
            <Text  fontSize={10} color={0xA0AEC0}>{item.label}</Text>
          </Container>
        ))}
      </Container>
    </Fullscreen>
  );
};

export default SplashScreen;
