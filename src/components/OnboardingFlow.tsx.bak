/**
 * Onboarding Flow - UIKit version
 * Renders INSIDE Canvas as 3D UI
 */

import { Container, Fullscreen, Text } from '@react-three/uikit';
import { Button, Card, CardContent, Progress } from '@react-three/uikit-default';
import { useState } from 'react';
import { log } from '../utils/Logger';

interface OnboardingFlowProps {
    onComplete: () => void;
}

interface OnboardingStep {
    title: string;
    description: string;
    gesture?: string;
    icon: string;
    action?: string;
}

const ONBOARDING_STEPS: OnboardingStep[] = [
    {
        title: 'Welcome to Ebb & Bloom',
        description: 'A meditative evolutionary ecosystem where consciousness flows through living forms. You are awareness itself, witnessing emergence of complexity.',
        icon: 'üå±',
        action: 'Begin Journey'
    },
    {
        title: 'Camera: Spore-Style Exploration',
        description: 'Pinch to zoom ‚Ä¢ Drag to orbit ‚Ä¢ Double-tap to reset view',
        gesture: 'pinch',
        icon: 'üì∑',
        action: 'Try Camera'
    },
    {
        title: 'Observe: Watch Life Unfold',
        description: 'Tap creatures to see their traits, pack dynamics, and evolutionary history. Your gaze influences their awareness.',
        gesture: 'tap',
        icon: 'üëÅÔ∏è',
        action: 'Practice Observing'
    },
    {
        title: 'Influence: Guide Evolution',
        description: 'Long-press to nudge evolutionary pressures. The ecosystem responds organically, never forced.',
        gesture: 'long-press',
        icon: 'üß¨',
        action: 'Try Influencing'
    }
];

const OnboardingFlow: React.FC<OnboardingFlowProps> = ({ onComplete }) => {
    const [currentStep, setCurrentStep] = useState(0);
    const [gestureAttempted, setGestureAttempted] = useState(false);

    const step = ONBOARDING_STEPS[currentStep];
    const progress = (currentStep + 1) / ONBOARDING_STEPS.length;

    const handleNext = () => {
        if (currentStep < ONBOARDING_STEPS.length - 1) {
            setCurrentStep(currentStep + 1);
            setGestureAttempted(false);
        } else {
            onComplete();
        }
    };

    const handleSkip = () => {
        log.info('Onboarding skipped');
        onComplete();
    };

    return (
        <Fullscreen
            backgroundColor={0x1a202c}
            opacity={0.95}
            flexDirection="column"
            alignItems="center"
            justifyContent="center"
            padding={32}
        >
            {/* Progress Bar */}
            <Container positionType="absolute" positionTop={32} width={600}>
                <Progress value={progress} width="100%" />
                <Text
                    
                    fontSize={10}
                    color={0xA0AEC0}
                    marginTop={8}
                >
                    Step {currentStep + 1} of {ONBOARDING_STEPS.length}
                </Text>
            </Container>

            {/* Main Content */}
            <Card width={700} padding={32}>
                <CardContent flexDirection="column" alignItems="center" gap={32}>
                    {/* Icon */}
                    <Container
                        width={96}
                        height={96}
                        borderRadius={48}
                        backgroundColor={0xD69E2E}
                        opacity={0.2}
                        borderWidth={1}
                        borderColor={0xD69E2E}
                        flexDirection="column"
                        alignItems="center"
                        justifyContent="center"
                    >
                        <Text fontSize={48}>{step.icon}</Text>
                    </Container>

                    {/* Title */}
                    <Text
                        
                        fontSize={32}
                        fontWeight="bold"
                        color={0xD69E2E}
                        textAlign="center"
                    >
                        {step.title}
                    </Text>

                    {/* Description */}
                    <Text
                        fontFamily="inter"
                        fontSize={18}
                        color={0xA0AEC0}
                        textAlign="center"
                        lineHeight="150%"
                    >
                        {step.description}
                    </Text>

                    {/* Gesture Practice (if applicable) */}
                    {step.gesture && (
                        <Button
                            onClick={() => setGestureAttempted(true)}
                            backgroundColor={0x38A169}
                            paddingX={24}
                            paddingY={16}
                            width="100%"
                        >
                            <Container flexDirection="row" alignItems="center" gap={8}>
                                <Text fontSize={16}>ü§≤</Text>
                                <Text fontSize={16}>Try {step.gesture} gesture</Text>
                            </Container>
                        </Button>
                    )}

                    {gestureAttempted && (
                        <Text fontSize={14} color={0x38A169}>
                            ‚úì Well done!
                        </Text>
                    )}

                    {/* Navigation */}
                    <Container flexDirection="row" gap={16} marginTop={32} width="100%">
                        <Button
                            onClick={handleSkip}
                            variant="outline"
                            flexGrow={1}
                        >
                            <Text fontSize={16}>Skip</Text>
                        </Button>
                        <Button
                            onClick={handleNext}
                            backgroundColor={0xD69E2E}
                            flexGrow={2}
                        >
                            <Text fontSize={16} fontWeight="bold">
                                {currentStep < ONBOARDING_STEPS.length - 1 ? 'Next ‚Üí' : 'Begin Evolution'}
                            </Text>
                        </Button>
                    </Container>
                </CardContent>
            </Card>

            {/* Footer */}
            <Text
                fontFamily="inter"
                fontSize={12}
                color={0xA0AEC0}
                opacity={0.6}
                marginTop={24}
            >
                "Every action ripples through generations..."
            </Text>
        </Fullscreen>
    );
};

export default OnboardingFlow;
