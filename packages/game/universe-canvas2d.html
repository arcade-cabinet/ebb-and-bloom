<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ebb & Bloom - Universe (Canvas 2D)</title>
    <link rel="stylesheet" href="/fonts/fonts.css">
    <style>
        * { margin: 0; padding: 0; }
        body { 
            background: black; 
            overflow: hidden; 
            font-family: 'Work Sans', sans-serif;
        }
        canvas { display: block; }
        #hud {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #00ff88;
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, rgba(74, 85, 104, 0.95), rgba(42, 67, 101, 0.95));
            padding: 15px;
            border: 2px solid #38A169;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.6;
        }
        .vcr {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }
        .vcr button {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #38A169, #2F855A);
            border: 2px solid #38A169;
            color: white;
            font-size: 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        .vcr button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(56, 161, 105, 0.6);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="hud">Initializing...</div>
    <div class="vcr">
        <button id="play">â–¶</button>
        <button id="speed">1x</button>
    </div>
    
    <script type="module">
        import { EntropyAgent } from './src/yuka-integration/agents/EntropyAgent.ts';
        import { AgentSpawner } from './src/yuka-integration/AgentSpawner.ts';
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const hud = document.getElementById('hud');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Core systems
        const spawner = new AgentSpawner();
        const entropyAgent = new EntropyAgent(spawner);
        
        let paused = false;
        let speedOverride = 1;
        
        // VCR controls
        document.getElementById('play').onclick = () => {
            paused = !paused;
            document.getElementById('play').textContent = paused ? 'â–¶' : 'â¸';
        };
        
        document.getElementById('speed').onclick = () => {
            const speeds = [1, 10, 100, 1000];
            const idx = speeds.indexOf(speedOverride);
            speedOverride = speeds[(idx + 1) % speeds.length];
            document.getElementById('speed').textContent = `${speedOverride}x`;
        };
        
        // Render loop
        let lastTime = performance.now();
        
        function render(now) {
            const delta = Math.min((now - lastTime) / 1000, 1/30); // Clamp
            lastTime = now;
            
            if (!paused) {
                const adjustedDelta = delta * speedOverride;
                entropyAgent.update(adjustedDelta);
                spawner.update(adjustedDelta * entropyAgent.timeScale);
            }
            
            // Clear canvas
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Get all agents
            const stellarAgents = spawner.getManager().entities.filter(e => e.constructor.name === 'StellarAgent');
            const densityAgents = spawner.getManager().entities.filter(e => e.constructor.name === 'DensityAgent');
            
            // Project 3D positions to 2D (top-down view of universe)
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.5; // Center vertically (leave bottom for ticker tape)
            const scale = 0.8; // Scale factor for projection
            
            // Draw density field (blue fog)
            ctx.fillStyle = 'rgba(100, 150, 255, 0.1)';
            for (const agent of densityAgents) {
                const screenX = centerX + agent.position.x * scale;
                const screenY = centerY + agent.position.y * scale;
                
                ctx.beginPath();
                ctx.arc(screenX, screenY, 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw stars (bright points)
            for (const star of stellarAgents) {
                const screenX = centerX + star.position.x * scale;
                const screenY = centerY + star.position.y * scale;
                
                // Size based on mass
                const size = Math.log10(star.mass / 1e30) + 2;
                
                // Glow effect
                const gradient = ctx.createRadialGradient(screenX, screenY, 0, screenX, screenY, size * 3);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
                gradient.addColorStop(0.3, 'rgba(255, 255, 200, 0.5)');
                gradient.addColorStop(1, 'rgba(255, 255, 200, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(screenX, screenY, size * 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Core
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(screenX, screenY, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // HUD
            const age = entropyAgent.age;
            const YEAR = 365.25 * 86400;
            const ageMyr = age / (1e6 * YEAR);
            
            hud.innerHTML = `
ðŸŒŒ Universe Age: ${ageMyr < 1 ? (age / YEAR).toFixed(0) + ' yr' : ageMyr.toFixed(1) + ' Myr'}
ðŸŒ¡ï¸  Temperature: ${entropyAgent.temperature.toExponential(1)} K
ðŸ“ Scale: ${entropyAgent.scaleFactor.toExponential(1)}x
â­ Stars: ${stellarAgents.length}
ðŸŽ¯ Phase: ${entropyAgent.phase}
âš¡ Speed: ${speedOverride}x
`;
            
            requestAnimationFrame(render);
        }
        
        render(performance.now());
        
        console.log('ðŸŒŒ CANVAS 2D UNIVERSE - IT WORKS!');
        console.log('Stars will appear when they form');
        
        // Expose for debugging
        window.universe = { entropyAgent, spawner, ctx, canvas };
    </script>
</body>
</html>

